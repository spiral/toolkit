!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("@spiral-toolkit/core")):"function"==typeof define&&define.amd?define("@spiral-toolkit/datagrid",["@spiral-toolkit/core"],e):"object"==typeof exports?exports["@spiral-toolkit/datagrid"]=e(require("@spiral-toolkit/core")):t.SFDataGrid=e(t["@spiral-toolkit/core"])}(window,(function(t){return function(t){var e={};function s(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,s),r.l=!0,r.exports}return s.m=t,s.c=e,s.d=function(t,e,i){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)s.d(i,r,function(e){return t[e]}.bind(null,r));return i},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="/",s(s.s=3)}([function(e,s){e.exports=t},function(t,e,s){"use strict";const i=s(10),r=s(11),n=s(12);function o(t){if("string"!=typeof t||1!==t.length)throw new TypeError("arrayFormatSeparator must be single character string")}function a(t,e){return e.encode?e.strict?i(t):encodeURIComponent(t):t}function c(t,e){return e.decode?r(t):t}function l(t){const e=t.indexOf("#");return-1!==e&&(t=t.slice(0,e)),t}function u(t){const e=(t=l(t)).indexOf("?");return-1===e?"":t.slice(e+1)}function p(t,e){return e.parseNumbers&&!Number.isNaN(Number(t))&&"string"==typeof t&&""!==t.trim()?t=Number(t):!e.parseBooleans||null===t||"true"!==t.toLowerCase()&&"false"!==t.toLowerCase()||(t="true"===t.toLowerCase()),t}function h(t,e){o((e=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},e)).arrayFormatSeparator);const s=function(t){let e;switch(t.arrayFormat){case"index":return(t,s,i)=>{e=/\[(\d*)\]$/.exec(t),t=t.replace(/\[\d*\]$/,""),e?(void 0===i[t]&&(i[t]={}),i[t][e[1]]=s):i[t]=s};case"bracket":return(t,s,i)=>{e=/(\[\])$/.exec(t),t=t.replace(/\[\]$/,""),e?void 0!==i[t]?i[t]=[].concat(i[t],s):i[t]=[s]:i[t]=s};case"comma":case"separator":return(e,s,i)=>{const r="string"==typeof s&&s.split("").indexOf(t.arrayFormatSeparator)>-1?s.split(t.arrayFormatSeparator).map(e=>c(e,t)):null===s?s:c(s,t);i[e]=r};default:return(t,e,s)=>{void 0!==s[t]?s[t]=[].concat(s[t],e):s[t]=e}}}(e),i=Object.create(null);if("string"!=typeof t)return i;if(!(t=t.trim().replace(/^[?#&]/,"")))return i;for(const r of t.split("&")){let[t,o]=n(e.decode?r.replace(/\+/g," "):r,"=");o=void 0===o?null:"comma"===e.arrayFormat?o:c(o,e),s(c(t,e),o,i)}for(const t of Object.keys(i)){const s=i[t];if("object"==typeof s&&null!==s)for(const t of Object.keys(s))s[t]=p(s[t],e);else i[t]=p(s,e)}return!1===e.sort?i:(!0===e.sort?Object.keys(i).sort():Object.keys(i).sort(e.sort)).reduce((t,e)=>{const s=i[e];return Boolean(s)&&"object"==typeof s&&!Array.isArray(s)?t[e]=function t(e){return Array.isArray(e)?e.sort():"object"==typeof e?t(Object.keys(e)).sort((t,e)=>Number(t)-Number(e)).map(t=>e[t]):e}(s):t[e]=s,t},Object.create(null))}e.extract=u,e.parse=h,e.stringify=(t,e)=>{if(!t)return"";o((e=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},e)).arrayFormatSeparator);const s=s=>e.skipNull&&null==t[s]||e.skipEmptyString&&""===t[s],i=function(t){switch(t.arrayFormat){case"index":return e=>(s,i)=>{const r=s.length;return void 0===i||t.skipNull&&null===i||t.skipEmptyString&&""===i?s:null===i?[...s,[a(e,t),"[",r,"]"].join("")]:[...s,[a(e,t),"[",a(r,t),"]=",a(i,t)].join("")]};case"bracket":return e=>(s,i)=>void 0===i||t.skipNull&&null===i||t.skipEmptyString&&""===i?s:null===i?[...s,[a(e,t),"[]"].join("")]:[...s,[a(e,t),"[]=",a(i,t)].join("")];case"comma":case"separator":return e=>(s,i)=>null==i||0===i.length?s:0===s.length?[[a(e,t),"=",a(i,t)].join("")]:[[s,a(i,t)].join(t.arrayFormatSeparator)];default:return e=>(s,i)=>void 0===i||t.skipNull&&null===i||t.skipEmptyString&&""===i?s:null===i?[...s,a(e,t)]:[...s,[a(e,t),"=",a(i,t)].join("")]}}(e),r={};for(const e of Object.keys(t))s(e)||(r[e]=t[e]);const n=Object.keys(r);return!1!==e.sort&&n.sort(e.sort),n.map(s=>{const r=t[s];return void 0===r?"":null===r?a(s,e):Array.isArray(r)?r.reduce(i(s),[]).join("&"):a(s,e)+"="+a(r,e)}).filter(t=>t.length>0).join("&")},e.parseUrl=(t,e)=>({url:l(t).split("?")[0]||"",query:h(u(t),e)}),e.stringifyUrl=(t,s)=>{const i=l(t.url).split("?")[0]||"",r=e.extract(t.url),n=e.parse(r),o=function(t){let e="";const s=t.indexOf("#");return-1!==s&&(e=t.slice(s)),e}(t.url),a=Object.assign(n,t.query);let c=e.stringify(a,s);return c&&(c=`?${c}`),`${i}${c}${o}`}},function(t,e,s){"use strict";(function(e){var i=s(5);
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
 * @license  MIT
 */function r(t,e){if(t===e)return 0;for(var s=t.length,i=e.length,r=0,n=Math.min(s,i);r<n;++r)if(t[r]!==e[r]){s=t[r],i=e[r];break}return s<i?-1:i<s?1:0}function n(t){return e.Buffer&&"function"==typeof e.Buffer.isBuffer?e.Buffer.isBuffer(t):!(null==t||!t._isBuffer)}var o=s(6),a=Object.prototype.hasOwnProperty,c=Array.prototype.slice,l="foo"===function(){}.name;function u(t){return Object.prototype.toString.call(t)}function p(t){return!n(t)&&("function"==typeof e.ArrayBuffer&&("function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(t):!!t&&(t instanceof DataView||!!(t.buffer&&t.buffer instanceof ArrayBuffer))))}var h=t.exports=b,d=/\s*function\s+([^\(\s]*)\s*/;function f(t){if(o.isFunction(t)){if(l)return t.name;var e=t.toString().match(d);return e&&e[1]}}function g(t,e){return"string"==typeof t?t.length<e?t:t.slice(0,e):t}function m(t){if(l||!o.isFunction(t))return o.inspect(t);var e=f(t);return"[Function"+(e?": "+e:"")+"]"}function y(t,e,s,i,r){throw new h.AssertionError({message:s,actual:t,expected:e,operator:i,stackStartFunction:r})}function b(t,e){t||y(t,!0,e,"==",h.ok)}function O(t,e,s,i){if(t===e)return!0;if(n(t)&&n(e))return 0===r(t,e);if(o.isDate(t)&&o.isDate(e))return t.getTime()===e.getTime();if(o.isRegExp(t)&&o.isRegExp(e))return t.source===e.source&&t.global===e.global&&t.multiline===e.multiline&&t.lastIndex===e.lastIndex&&t.ignoreCase===e.ignoreCase;if(null!==t&&"object"==typeof t||null!==e&&"object"==typeof e){if(p(t)&&p(e)&&u(t)===u(e)&&!(t instanceof Float32Array||t instanceof Float64Array))return 0===r(new Uint8Array(t.buffer),new Uint8Array(e.buffer));if(n(t)!==n(e))return!1;var a=(i=i||{actual:[],expected:[]}).actual.indexOf(t);return-1!==a&&a===i.expected.indexOf(e)||(i.actual.push(t),i.expected.push(e),function(t,e,s,i){if(null==t||null==e)return!1;if(o.isPrimitive(t)||o.isPrimitive(e))return t===e;if(s&&Object.getPrototypeOf(t)!==Object.getPrototypeOf(e))return!1;var r=v(t),n=v(e);if(r&&!n||!r&&n)return!1;if(r)return t=c.call(t),e=c.call(e),O(t,e,s);var a,l,u=w(t),p=w(e);if(u.length!==p.length)return!1;for(u.sort(),p.sort(),l=u.length-1;l>=0;l--)if(u[l]!==p[l])return!1;for(l=u.length-1;l>=0;l--)if(a=u[l],!O(t[a],e[a],s,i))return!1;return!0}(t,e,s,i))}return s?t===e:t==e}function v(t){return"[object Arguments]"==Object.prototype.toString.call(t)}function E(t,e){if(!t||!e)return!1;if("[object RegExp]"==Object.prototype.toString.call(e))return e.test(t);try{if(t instanceof e)return!0}catch(t){}return!Error.isPrototypeOf(e)&&!0===e.call({},t)}function j(t,e,s,i){var r;if("function"!=typeof e)throw new TypeError('"block" argument must be a function');"string"==typeof s&&(i=s,s=null),r=function(t){var e;try{t()}catch(t){e=t}return e}(e),i=(s&&s.name?" ("+s.name+").":".")+(i?" "+i:"."),t&&!r&&y(r,s,"Missing expected exception"+i);var n="string"==typeof i,a=!t&&r&&!s;if((!t&&o.isError(r)&&n&&E(r,s)||a)&&y(r,s,"Got unwanted exception"+i),t&&r&&s&&!E(r,s)||!t&&r)throw r}h.AssertionError=function(t){var e;this.name="AssertionError",this.actual=t.actual,this.expected=t.expected,this.operator=t.operator,t.message?(this.message=t.message,this.generatedMessage=!1):(this.message=g(m((e=this).actual),128)+" "+e.operator+" "+g(m(e.expected),128),this.generatedMessage=!0);var s=t.stackStartFunction||y;if(Error.captureStackTrace)Error.captureStackTrace(this,s);else{var i=new Error;if(i.stack){var r=i.stack,n=f(s),o=r.indexOf("\n"+n);if(o>=0){var a=r.indexOf("\n",o+1);r=r.substring(a+1)}this.stack=r}}},o.inherits(h.AssertionError,Error),h.fail=y,h.ok=b,h.equal=function(t,e,s){t!=e&&y(t,e,s,"==",h.equal)},h.notEqual=function(t,e,s){t==e&&y(t,e,s,"!=",h.notEqual)},h.deepEqual=function(t,e,s){O(t,e,!1)||y(t,e,s,"deepEqual",h.deepEqual)},h.deepStrictEqual=function(t,e,s){O(t,e,!0)||y(t,e,s,"deepStrictEqual",h.deepStrictEqual)},h.notDeepEqual=function(t,e,s){O(t,e,!1)&&y(t,e,s,"notDeepEqual",h.notDeepEqual)},h.notDeepStrictEqual=function t(e,s,i){O(e,s,!0)&&y(e,s,i,"notDeepStrictEqual",t)},h.strictEqual=function(t,e,s){t!==e&&y(t,e,s,"===",h.strictEqual)},h.notStrictEqual=function(t,e,s){t===e&&y(t,e,s,"!==",h.notStrictEqual)},h.throws=function(t,e,s){j(!0,t,e,s)},h.doesNotThrow=function(t,e,s){j(!1,t,e,s)},h.ifError=function(t){if(t)throw t},h.strict=i((function t(e,s){e||y(e,!0,s,"==",t)}),h,{equal:h.strictEqual,deepEqual:h.deepStrictEqual,notEqual:h.notStrictEqual,notDeepEqual:h.notDeepStrictEqual}),h.strict.strict=h.strict;var w=Object.keys||function(t){var e=[];for(var s in t)a.call(t,s)&&e.push(s);return e}}).call(this,s(4))},function(t,e,s){t.exports=s(13)},function(t,e){var s;s=function(){return this}();try{s=s||new Function("return this")()}catch(t){"object"==typeof window&&(s=window)}t.exports=s},function(t,e,s){"use strict";
/*
object-assign
(c) Sindre Sorhus
@license MIT
*/var i=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable;function o(t){if(null==t)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(t)}t.exports=function(){try{if(!Object.assign)return!1;var t=new String("abc");if(t[5]="de","5"===Object.getOwnPropertyNames(t)[0])return!1;for(var e={},s=0;s<10;s++)e["_"+String.fromCharCode(s)]=s;if("0123456789"!==Object.getOwnPropertyNames(e).map((function(t){return e[t]})).join(""))return!1;var i={};return"abcdefghijklmnopqrst".split("").forEach((function(t){i[t]=t})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},i)).join("")}catch(t){return!1}}()?Object.assign:function(t,e){for(var s,a,c=o(t),l=1;l<arguments.length;l++){for(var u in s=Object(arguments[l]))r.call(s,u)&&(c[u]=s[u]);if(i){a=i(s);for(var p=0;p<a.length;p++)n.call(s,a[p])&&(c[a[p]]=s[a[p]])}}return c}},function(t,e,s){(function(t){var i=Object.getOwnPropertyDescriptors||function(t){for(var e=Object.keys(t),s={},i=0;i<e.length;i++)s[e[i]]=Object.getOwnPropertyDescriptor(t,e[i]);return s},r=/%[sdj%]/g;e.format=function(t){if(!y(t)){for(var e=[],s=0;s<arguments.length;s++)e.push(a(arguments[s]));return e.join(" ")}s=1;for(var i=arguments,n=i.length,o=String(t).replace(r,(function(t){if("%%"===t)return"%";if(s>=n)return t;switch(t){case"%s":return String(i[s++]);case"%d":return Number(i[s++]);case"%j":try{return JSON.stringify(i[s++])}catch(t){return"[Circular]"}default:return t}})),c=i[s];s<n;c=i[++s])g(c)||!v(c)?o+=" "+c:o+=" "+a(c);return o},e.deprecate=function(s,i){if(void 0!==t&&!0===t.noDeprecation)return s;if(void 0===t)return function(){return e.deprecate(s,i).apply(this,arguments)};var r=!1;return function(){if(!r){if(t.throwDeprecation)throw new Error(i);t.traceDeprecation?console.trace(i):console.error(i),r=!0}return s.apply(this,arguments)}};var n,o={};function a(t,s){var i={seen:[],stylize:l};return arguments.length>=3&&(i.depth=arguments[2]),arguments.length>=4&&(i.colors=arguments[3]),f(s)?i.showHidden=s:s&&e._extend(i,s),b(i.showHidden)&&(i.showHidden=!1),b(i.depth)&&(i.depth=2),b(i.colors)&&(i.colors=!1),b(i.customInspect)&&(i.customInspect=!0),i.colors&&(i.stylize=c),u(i,t,i.depth)}function c(t,e){var s=a.styles[e];return s?"["+a.colors[s][0]+"m"+t+"["+a.colors[s][1]+"m":t}function l(t,e){return t}function u(t,s,i){if(t.customInspect&&s&&w(s.inspect)&&s.inspect!==e.inspect&&(!s.constructor||s.constructor.prototype!==s)){var r=s.inspect(i,t);return y(r)||(r=u(t,r,i)),r}var n=function(t,e){if(b(e))return t.stylize("undefined","undefined");if(y(e)){var s="'"+JSON.stringify(e).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return t.stylize(s,"string")}if(m(e))return t.stylize(""+e,"number");if(f(e))return t.stylize(""+e,"boolean");if(g(e))return t.stylize("null","null")}(t,s);if(n)return n;var o=Object.keys(s),a=function(t){var e={};return t.forEach((function(t,s){e[t]=!0})),e}(o);if(t.showHidden&&(o=Object.getOwnPropertyNames(s)),j(s)&&(o.indexOf("message")>=0||o.indexOf("description")>=0))return p(s);if(0===o.length){if(w(s)){var c=s.name?": "+s.name:"";return t.stylize("[Function"+c+"]","special")}if(O(s))return t.stylize(RegExp.prototype.toString.call(s),"regexp");if(E(s))return t.stylize(Date.prototype.toString.call(s),"date");if(j(s))return p(s)}var l,v="",S=!1,C=["{","}"];(d(s)&&(S=!0,C=["[","]"]),w(s))&&(v=" [Function"+(s.name?": "+s.name:"")+"]");return O(s)&&(v=" "+RegExp.prototype.toString.call(s)),E(s)&&(v=" "+Date.prototype.toUTCString.call(s)),j(s)&&(v=" "+p(s)),0!==o.length||S&&0!=s.length?i<0?O(s)?t.stylize(RegExp.prototype.toString.call(s),"regexp"):t.stylize("[Object]","special"):(t.seen.push(s),l=S?function(t,e,s,i,r){for(var n=[],o=0,a=e.length;o<a;++o)T(e,String(o))?n.push(h(t,e,s,i,String(o),!0)):n.push("");return r.forEach((function(r){r.match(/^\d+$/)||n.push(h(t,e,s,i,r,!0))})),n}(t,s,i,a,o):o.map((function(e){return h(t,s,i,a,e,S)})),t.seen.pop(),function(t,e,s){if(t.reduce((function(t,e){return e.indexOf("\n")>=0&&0,t+e.replace(/\u001b\[\d\d?m/g,"").length+1}),0)>60)return s[0]+(""===e?"":e+"\n ")+" "+t.join(",\n  ")+" "+s[1];return s[0]+e+" "+t.join(", ")+" "+s[1]}(l,v,C)):C[0]+v+C[1]}function p(t){return"["+Error.prototype.toString.call(t)+"]"}function h(t,e,s,i,r,n){var o,a,c;if((c=Object.getOwnPropertyDescriptor(e,r)||{value:e[r]}).get?a=c.set?t.stylize("[Getter/Setter]","special"):t.stylize("[Getter]","special"):c.set&&(a=t.stylize("[Setter]","special")),T(i,r)||(o="["+r+"]"),a||(t.seen.indexOf(c.value)<0?(a=g(s)?u(t,c.value,null):u(t,c.value,s-1)).indexOf("\n")>-1&&(a=n?a.split("\n").map((function(t){return"  "+t})).join("\n").substr(2):"\n"+a.split("\n").map((function(t){return"   "+t})).join("\n")):a=t.stylize("[Circular]","special")),b(o)){if(n&&r.match(/^\d+$/))return a;(o=JSON.stringify(""+r)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(o=o.substr(1,o.length-2),o=t.stylize(o,"name")):(o=o.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),o=t.stylize(o,"string"))}return o+": "+a}function d(t){return Array.isArray(t)}function f(t){return"boolean"==typeof t}function g(t){return null===t}function m(t){return"number"==typeof t}function y(t){return"string"==typeof t}function b(t){return void 0===t}function O(t){return v(t)&&"[object RegExp]"===S(t)}function v(t){return"object"==typeof t&&null!==t}function E(t){return v(t)&&"[object Date]"===S(t)}function j(t){return v(t)&&("[object Error]"===S(t)||t instanceof Error)}function w(t){return"function"==typeof t}function S(t){return Object.prototype.toString.call(t)}function C(t){return t<10?"0"+t.toString(10):t.toString(10)}e.debuglog=function(s){if(b(n)&&(n=t.env.NODE_DEBUG||""),s=s.toUpperCase(),!o[s])if(new RegExp("\\b"+s+"\\b","i").test(n)){var i=t.pid;o[s]=function(){var t=e.format.apply(e,arguments);console.error("%s %d: %s",s,i,t)}}else o[s]=function(){};return o[s]},e.inspect=a,a.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},a.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},e.isArray=d,e.isBoolean=f,e.isNull=g,e.isNullOrUndefined=function(t){return null==t},e.isNumber=m,e.isString=y,e.isSymbol=function(t){return"symbol"==typeof t},e.isUndefined=b,e.isRegExp=O,e.isObject=v,e.isDate=E,e.isError=j,e.isFunction=w,e.isPrimitive=function(t){return null===t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||"symbol"==typeof t||void 0===t},e.isBuffer=s(8);var k=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function x(){var t=new Date,e=[C(t.getHours()),C(t.getMinutes()),C(t.getSeconds())].join(":");return[t.getDate(),k[t.getMonth()],e].join(" ")}function T(t,e){return Object.prototype.hasOwnProperty.call(t,e)}e.log=function(){console.log("%s - %s",x(),e.format.apply(e,arguments))},e.inherits=s(9),e._extend=function(t,e){if(!e||!v(e))return t;for(var s=Object.keys(e),i=s.length;i--;)t[s[i]]=e[s[i]];return t};var P="undefined"!=typeof Symbol?Symbol("util.promisify.custom"):void 0;function A(t,e){if(!t){var s=new Error("Promise was rejected with a falsy value");s.reason=t,t=s}return e(t)}e.promisify=function(t){if("function"!=typeof t)throw new TypeError('The "original" argument must be of type Function');if(P&&t[P]){var e;if("function"!=typeof(e=t[P]))throw new TypeError('The "util.promisify.custom" argument must be of type Function');return Object.defineProperty(e,P,{value:e,enumerable:!1,writable:!1,configurable:!0}),e}function e(){for(var e,s,i=new Promise((function(t,i){e=t,s=i})),r=[],n=0;n<arguments.length;n++)r.push(arguments[n]);r.push((function(t,i){t?s(t):e(i)}));try{t.apply(this,r)}catch(t){s(t)}return i}return Object.setPrototypeOf(e,Object.getPrototypeOf(t)),P&&Object.defineProperty(e,P,{value:e,enumerable:!1,writable:!1,configurable:!0}),Object.defineProperties(e,i(t))},e.promisify.custom=P,e.callbackify=function(e){if("function"!=typeof e)throw new TypeError('The "original" argument must be of type Function');function s(){for(var s=[],i=0;i<arguments.length;i++)s.push(arguments[i]);var r=s.pop();if("function"!=typeof r)throw new TypeError("The last argument must be of type Function");var n=this,o=function(){return r.apply(n,arguments)};e.apply(this,s).then((function(e){t.nextTick(o,null,e)}),(function(e){t.nextTick(A,e,o)}))}return Object.setPrototypeOf(s,Object.getPrototypeOf(e)),Object.defineProperties(s,i(e)),s}}).call(this,s(7))},function(t,e){var s,i,r=t.exports={};function n(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function a(t){if(s===setTimeout)return setTimeout(t,0);if((s===n||!s)&&setTimeout)return s=setTimeout,setTimeout(t,0);try{return s(t,0)}catch(e){try{return s.call(null,t,0)}catch(e){return s.call(this,t,0)}}}!function(){try{s="function"==typeof setTimeout?setTimeout:n}catch(t){s=n}try{i="function"==typeof clearTimeout?clearTimeout:o}catch(t){i=o}}();var c,l=[],u=!1,p=-1;function h(){u&&c&&(u=!1,c.length?l=c.concat(l):p=-1,l.length&&d())}function d(){if(!u){var t=a(h);u=!0;for(var e=l.length;e;){for(c=l,l=[];++p<e;)c&&c[p].run();p=-1,e=l.length}c=null,u=!1,function(t){if(i===clearTimeout)return clearTimeout(t);if((i===o||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(t);try{i(t)}catch(e){try{return i.call(null,t)}catch(e){return i.call(this,t)}}}(t)}}function f(t,e){this.fun=t,this.array=e}function g(){}r.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var s=1;s<arguments.length;s++)e[s-1]=arguments[s];l.push(new f(t,e)),1!==l.length||u||a(d)},f.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=g,r.addListener=g,r.once=g,r.off=g,r.removeListener=g,r.removeAllListeners=g,r.emit=g,r.prependListener=g,r.prependOnceListener=g,r.listeners=function(t){return[]},r.binding=function(t){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(t){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}},function(t,e){t.exports=function(t){return t&&"object"==typeof t&&"function"==typeof t.copy&&"function"==typeof t.fill&&"function"==typeof t.readUInt8}},function(t,e){"function"==typeof Object.create?t.exports=function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(t,e){t.super_=e;var s=function(){};s.prototype=e.prototype,t.prototype=new s,t.prototype.constructor=t}},function(t,e,s){"use strict";t.exports=t=>encodeURIComponent(t).replace(/[!'()*]/g,t=>`%${t.charCodeAt(0).toString(16).toUpperCase()}`)},function(t,e,s){"use strict";var i=new RegExp("%[a-f0-9]{2}","gi"),r=new RegExp("(%[a-f0-9]{2})+","gi");function n(t,e){try{return decodeURIComponent(t.join(""))}catch(t){}if(1===t.length)return t;e=e||1;var s=t.slice(0,e),i=t.slice(e);return Array.prototype.concat.call([],n(s),n(i))}function o(t){try{return decodeURIComponent(t)}catch(r){for(var e=t.match(i),s=1;s<e.length;s++)e=(t=n(e,s).join("")).match(i);return t}}t.exports=function(t){if("string"!=typeof t)throw new TypeError("Expected `encodedURI` to be of type `string`, got `"+typeof t+"`");try{return t=t.replace(/\+/g," "),decodeURIComponent(t)}catch(e){return function(t){for(var e={"%FE%FF":"ï¿½ï¿½","%FF%FE":"ï¿½ï¿½"},s=r.exec(t);s;){try{e[s[0]]=decodeURIComponent(s[0])}catch(t){var i=o(s[0]);i!==s[0]&&(e[s[0]]=i)}s=r.exec(t)}e["%C2"]="ï¿½";for(var n=Object.keys(e),a=0;a<n.length;a++){var c=n[a];t=t.replace(new RegExp(c,"g"),e[c])}return t}(t)}}},function(t,e,s){"use strict";t.exports=(t,e)=>{if("string"!=typeof t||"string"!=typeof e)throw new TypeError("Expected the arguments to be of type `string`");if(""===e)return[t];const s=t.indexOf(e);return-1===s?[t]:[t.slice(0,s),t.slice(s+e.length)]}},function(t,e,s){"use strict";s.r(e);var i,r,n,o=s(0),a=s.n(o);!function(t){t.ASC="asc",t.DESC="desc"}(i||(i={})),function(t){t.SINGLE="single",t.MULTIPLE="multiple"}(r||(r={})),function(t){t.GET="GET",t.POST="POST",t.DELETE="DELETE",t.PUT="PUT",t.PATCH="PATCH"}(n||(n={}));const c=["page","limit","cid","lid"],l=["sortBy","sortDir"],u={noData:"No Data",noResults:"No data matches your search criteria",error:"Unknown error"},p={currentPage:"Showing {from} to {to} of {total} entries",currentPageNoTotal:"Showing {from} to {to}",error:"Showing no entries",limitLabel:"Show",nextPage:"Â»",prevPage:"Â«",ellipsis:"..."};var h;!function(t){t.pages="pages",t.infinite="infinite"}(h||(h={}));const d=t=>{const e=t.querySelector('script[role="sf-options"]');if(e)if("text/javascript"===e.getAttribute("type"))try{return Function(`"use strict";return ${e.innerHTML.trim()}`)()()}catch(t){console.error("Could not parse options inside script, ensure script inside is an anonymous function returning object")}else try{return JSON.parse(e.innerHTML.trim())}catch(t){console.error("Could not parse options inside script, ensure script inside is a JSON")}};class f extends a.a.core.BaseDOMConstructor{constructor(t,e,s){super(),this.name=f.spiralFrameworkName,this.optionsToGrab={id:{value:f.defaultOptions.id,domAttr:"id"},type:{value:f.defaultOptions.selectionType,domAttr:"data-selection-type"},className:{value:f.defaultOptions.className,domAttr:"data-class"}},this.options=Object.assign({},f.defaultOptions),this.state={hasSelection:!1,selectedCount:0,selectedItems:[],selectedKeys:new Set,selectionType:this.options.selectionType},this.init(t,e,s),this.options=Object.assign(Object.assign(Object.assign({},f.defaultOptions),this.options),d(e)),this.render()}reconfigure(t){this.options=Object.assign(Object.assign({},this.options),t),this.state={hasSelection:!1,selectedCount:0,selectedItems:[],selectedKeys:new Set,selectionType:this.options.selectionType},this.render()}unlock(){this.options.lockType&&"none"!==this.options.lockType&&(this.sf.removeInstance("lock",this.node)||console.warn("You try to remove 'lock' instance, but it is not available or not started"))}lock(){if(!this.options.lockType||"none"===this.options.lockType)return;this.sf.addInstance("lock",this.node,{type:this.options.lockType})||console.warn("You try to add 'lock' instance, but it is not available or already started")}setSelection(t,e){this.state=Object.assign(Object.assign({},this.state),{selectedKeys:t,selectedItems:e,selectedCount:t.size,hasSelection:!!t.size}),this.render()}renderAs(t,e){if("string"==typeof e)t.innerHTML=e;else if("function"==typeof e){const s=e(this.state);"string"==typeof s?t.innerHTML=s:t.appendChild(s)}else t.appendChild(e)}renderAction(t,e,s){const i=document.createElement("div");return s.actionClassName&&("string"==typeof s.actionClassName?i.className=s.actionClassName:"function"==typeof s.actionClassName?i.className=s.actionClassName(t,this.state):i.className=s.actionClassName[t]||""),e.className&&("string"==typeof e.className?i.classList.add(...e.className.split(" ")):i.classList.add(...e.className(this.state).split(" "))),i.addEventListener("click",t=>e.onClick(this.state,this,t)),this.renderAs(i,e.renderAs),i}render(){this.el?this.el.innerHTML="":(this.el=document.createElement("div"),this.node.appendChild(this.el));const t=this.el;this.options.className&&(t.className="","string"==typeof this.options.className?t.classList.add(...this.options.className.split(" ")):t.classList.add(...this.options.className(this.state).split(" "))),!this.options.noSelection||this.state.hasSelection?(this.options.selectionLabel&&this.renderAs(t,this.options.selectionLabel),Object.keys(this.options.actions).forEach(e=>{t.appendChild(this.renderAction(e,this.options.actions[e],this.options))})):"string"==typeof this.options.noSelection?t.innerHTML=this.options.noSelection:t.appendChild(this.options.noSelection)}}f.spiralFrameworkName="datagrid-actions",f.defaultOptions={id:"",lockType:"none",actionClassName:"btn",selectionType:r.SINGLE,className:"row no-gutters align-items-center",actions:{}};var g=f,m=s(2),y=s(1);class b{constructor(t){this.parent=t,this.state={loading:!1,paginator:{page:1,limit:25},defaultData:{},fetchCount:!1,sortDir:i.ASC,data:[],formData:{},selection:new Set},this.state.fetchCount=this.parent.options.fetchCount}isSelected(t){return this.state.selection.has(String(t))}areAllSelected(){return this.data.reduce((t,e)=>t&&!!this.parent.options.selectable&&this.isSelected(String(e[this.parent.options.selectable.id])),!0)}get selection(){return this.state.selection}get isCustomSearch(){return!Object.keys(this.state.formData).reduce((t,e)=>{const s=this.state.formData[e],i=Object.keys(s).reduce((t,e)=>{const i=s[e],r=this.state.defaultData[e];return i&&r?t&&i==r:!(!i&&r||i&&!r)&&t},!0);return t&&i},!0)}get selectedItems(){return this.data.filter(t=>!!this.parent.options.selectable&&this.isSelected(String(t[this.parent.options.selectable.id])))}get isLoading(){return this.state.loading}startLoading(){this.state.loading=!0}get needFetchCount(){return this.state.fetchCount}resetFetchCount(){this.state.fetchCount=this.parent.options.fetchCount}onCountFetched(){this.state.fetchCount=!1}stopLoading(){this.state.loading=!1}get data(){return this.state.data}get paginate(){return this.state.paginator}get urlData(){return this.state.urlData}set urlData(t){this.state.urlData=t}updatePaginator(t){this.state.paginator=Object.assign(Object.assign({},this.state.paginator),t)}set data(t){this.state.data=t}get hasError(){return!!this.state.error}get errorMessage(){return this.state.error}get sortBy(){return this.state.sortBy}get sortDir(){return this.state.sortDir}setSuccess(t,e){this.data=t,this.state.error=void 0,this.state.errors=void 0,this.updatePaginator(e)}setError(t,e={},s=!1){s&&(this.data=[]),this.state.error=t,this.state.errors=e}setSort(t,e){this.state.sortBy=t,this.state.sortDir=e}setFormData(t,e){this.state.formData[t]=e}getFilter(){const t=Object.keys(this.state.formData).reduce((t,e)=>Object.assign(Object.assign({},t),this.state.formData[e]),{});return Object.assign(Object.assign({},this.state.urlData),t)}addToSelection(t){this.state.selection.add(String(t))}removeFromSelection(t){this.state.selection.delete(String(t))}selectSingle(t){this.state.selection.clear(),this.state.selection.add(String(t))}resetSelection(){this.state.selection.clear()}selectAll(){this.parent.options.selectable&&(this.state.selection=new Set(this.data.map(t=>String(t[this.parent.options.selectable.id]))))}mergeDefaultData(t={}){this.state.defaultData=Object.assign(Object.assign({},this.state.defaultData),t)}get defaultData(){return this.state.defaultData}}class O{constructor(t,e){this.definitions=t,this.defaultDefinitions=e}getMessage(t,e={}){return Object.keys(e).reduce((t,s)=>t.split(`{${s}}`).join(void 0===e[s]?"":String(e[s])),this.definitions[t]||this.defaultDefinitions[t]||"")}}class v extends a.a.core.BaseDOMConstructor{constructor(t,e,s){super(),this.name=v.spiralFrameworkName,this.optionsToGrab={id:{value:v.defaultOptions.id,domAttr:"id"},type:{value:v.defaultOptions.type,domAttr:"data-type"},willFetchCount:{value:v.defaultOptions.willFetchCount,domAttr:"data-fetch-count"}},this.options=Object.assign({},v.defaultOptions),this.state={error:!1,limit:25},this.init(t,e,s),this.options=Object.assign(Object.assign(Object.assign({},v.defaultOptions),this.options),d(e)),this.messages=new O(this.options.messages||{},p),this.render()}unlock(){this.options.lockType&&"none"!==this.options.lockType&&(this.sf.removeInstance("lock",this.node)||console.warn("You try to remove 'lock' instance, but it is not available or not started"))}lock(){if(!this.options.lockType||"none"===this.options.lockType)return;this.sf.addInstance("lock",this.node,{type:this.options.lockType})||console.warn("You try to add 'lock' instance, but it is not available or already started")}setParams(t,e){this.options.serialize=e,this.state=Object.assign(Object.assign({},this.state),t),this.render()}hasPages(){return void 0!==this.state.page&&void 0!==this.state.limit}hasTotal(){return this.options.willFetchCount&&void 0!==this.state.count}hasLimitOptions(){return void 0!==this.options.limitOptions}generatePageList(){const t=this.state.page,e=this.hasTotal()?Math.ceil(this.state.count/this.state.limit):t,s=!this.hasTotal()||t<e,i=t>1,r=[Math.max(t-1,1),Math.min(t+1,e)],n=[1,Math.min(2,e)],o=[Math.max(e-1,1),e],a=[];let c=1;do{a.push({page:c,text:`${c}`,active:t===c}),c>=n[1]&&c+1<r[0]?(a.push({page:void 0,text:this.messages.getMessage("ellipsis"),active:!1}),c=r[0]):c>=r[1]&&c+1<o[0]?(a.push({page:void 0,text:this.messages.getMessage("ellipsis"),active:!1}),c=o[0]):c+=1}while(c<=e);return{pages:a,hasNext:s,hasPrevious:i}}setLimit(t){this.state.limit=t,this.options.onPageChange&&this.options.onPageChange(this.state),this.render()}setPage(t){this.state.page=t,this.options.onPageChange&&this.options.onPageChange(this.state),this.render()}render(){const t=document.createElement("div");t.className="col-12 col-lg-4",this.hasPages()&&(this.hasTotal()?t.innerHTML=this.messages.getMessage("currentPage",{total:this.state.count,page:this.state.page,limit:this.state.limit,from:(this.state.page-1)*this.state.limit+1,to:this.state.page*this.state.limit}):t.innerHTML=this.messages.getMessage("currentPageNoTotal",{total:this.state.count,page:this.state.page,limit:this.state.limit,from:(this.state.page-1)*this.state.limit+1,to:this.state.page*this.state.limit})),this.state.error&&(t.innerHTML=this.messages.getMessage("error",{total:this.state.count,page:this.state.page,limit:this.state.limit,from:(this.state.page-1)*this.state.limit+1,to:this.state.page*this.state.limit}));const e=document.createElement("div");if(e.className="col-4 col-md-2 col-lg-2",this.hasLimitOptions()){e.innerHTML=`<div class="form-group row mb-0">\n                    <label class="col-form-label-sm col-auto">${this.messages.getMessage("limitLabel")}</label>\n                    <select name="limit" class="custom-select custom-select-sm col-6">\n                    </select>\n                  </div>`;const t=e.querySelector("select");this.options.limitOptions.forEach(e=>{const s=document.createElement("option");s.value=`${e}`,s.innerHTML=`${e}`,e===this.state.limit&&s.setAttribute("checked","checked"),t.appendChild(s)}),t.value=`${this.state.limit}`,t.addEventListener("change",()=>{this.setLimit(+t.value)})}const s=document.createElement("div");if(s.className="col-8 col-md-10 col-lg-6",this.hasPages()){s.innerHTML='<ul class="pagination pagination-sm justify-content-end mb-0">';const t=s.querySelector("ul"),e=this.generatePageList(),i=(e,s,i,r)=>{const n=document.createElement("li");n.className=e,r&&n.addEventListener("click",r),n.innerHTML=`<a href="${i||"#"}" tabindex="0" class="page-link">${s}</a>`,t.appendChild(n)},r=t=>{if(this.options.serialize)return Object(y.stringifyUrl)({url:window.location.href,query:{[!0===this.options.serialize?"page":`${this.options.serialize}page`]:t.toString()}})},n=t=>e=>(this.setPage(t),e.preventDefault(),!1);i(e.hasPrevious?"page-item previous":"page-item previous disabled",this.messages.getMessage("prevPage"),e.hasPrevious?r(this.state.page-1):void 0,e.hasPrevious?n(this.state.page-1):void 0),e.pages.forEach(t=>{i(t.active?"page-item active":"page-item",t.text,t.page?r(t.page):void 0,t.page?n(t.page):void 0)}),i(e.hasNext?"page-item next":"page-item next disabled",this.messages.getMessage("nextPage"),e.hasNext?r(this.state.page+1):void 0,e.hasNext?n(this.state.page+1):void 0)}this.el?this.el.innerHTML="":(this.el=document.createElement("div"),this.node.appendChild(this.el));const{el:i}=this;i.className=this.options.className||"",i.appendChild(t),i.appendChild(e),i.appendChild(s),this.state.error?null==i||i.classList.add("sf-paginator__error"):null==i||i.classList.remove("sf-paginator__error")}}v.spiralFrameworkName="datagrid-paginator",v.defaultOptions={id:"",lockType:"none",willFetchCount:!0,serialize:!0,type:h.pages,className:"row no-gutters align-items-center m-3",limitOptions:[10,25,50,100]};var E=v;const j={wrapperClassName:"table-responsive",tableClassName:"table table-striped",cellClassName:{},rowClassName:"",cellAttributes:t=>({}),rowAttributes:t=>({})},w={columns:[],sortable:[],ui:j},S={id:"",lockType:"default",resetOnError:!1,fetchCount:!0,captureForms:[],columns:[],headers:{},method:n.POST,sortable:[],url:"",serialize:!0,paginator:!0,ui:j,renderers:w},C=(t,e)=>{const s=e.map(t=>"string"==typeof t?{field:t,direction:void 0}:t);return t.map(t=>{let e,r,n,o=!1;"string"==typeof t?(e=t,r=t,n=i.ASC):(e=t.id,r=t.title||t.id,n=t.sortDir||i.ASC,o=!!t.sortDir);const a=s.find(t=>t.field===e);return a?{id:e,title:r,sortable:!0,direction:a.direction||n}:{id:e,title:r,sortable:o,direction:n}})},k=(t,e)=>{Object.keys(e).forEach(s=>{t.setAttribute(s,e[s])})};const x=(t,e,s,i)=>{const r=document.createElement("tbody");if(t.appendChild(r),s.hasError&&!e.dontRenderError){const t=document.createElement("tr"),n=document.createElement("td");n.colSpan=e.columns.length+(e.selectable?1:0),n.innerText=s.errorMessage||i.getMessage("error",{}),n.classList.add("sf-table__error"),t.appendChild(n),r.appendChild(t)}else if(0===s.data.length){const t=document.createElement("tr"),n=document.createElement("td");n.colSpan=e.columns.length+(e.selectable?1:0),n.innerHTML=s.isCustomSearch?i.getMessage("noResults",{}):i.getMessage("noData",{}),n.classList.add("sf-table__empty"),t.appendChild(n),r.appendChild(t)}return r},T=(t,e,s)=>{},P=(t,e,s)=>{const i=document.createElement("thead"),n=document.createElement("tr");if(e.selectable){const t=document.createElement("th");if(t.classList.add("sf-table__select"),e.selectable.type===r.MULTIPLE){const e=document.createElement("input");e.type="checkbox",e.setAttribute("data-datagrid-select-all",""),e.addEventListener("change",()=>{s.parent.toggleSelectionAll(e.checked)}),t.appendChild(e)}n.appendChild(t)}return i.appendChild(n),t.appendChild(i),{outer:i,inner:n}},A=(t,e,s,i)=>{const n=document.createElement("tr");if(t.appendChild(n),e.selectable){const t=document.createElement("td"),o=document.createElement("input");o.setAttribute("data-datagrid-select",""),o.type=e.selectable.type===r.MULTIPLE?"checkbox":"radio",o.value=s.data[i][e.selectable.id],o.checked=s.isSelected(o.value),o.addEventListener("change",()=>{s.parent.toggleSelection(o.value,o.checked)}),t.classList.add("sf-table__select"),t.appendChild(o),n.appendChild(t)}return n},F=(t,e)=>{const s=document.createElement("table");return s.className=e.ui.tableClassName||"",t.appendChild(s),s},N=()=>document.createElement("td"),D={createEl:N,render:t=>void 0===t?"":String(t)},L=()=>document.createElement("th"),M={createEl:L,render:(t,e,s)=>{const r=document.createElement("div"),n=[];return t.sortable&&(n.push("sf-table__sort"),r.addEventListener("click",()=>{s.parent.triggerSort(t.id)})),s.sortBy===t.id&&(s.sortDir===i.ASC?n.push("sf-table__sort_asc"):n.push("sf-table__sort_desc")),r.className=n.join(" "),r.innerText=t.title,r}};let I=1;class q{constructor(t,e){this.root=e,this.instance=I++,this.options=Object.assign(Object.assign(Object.assign({},w),t),{ui:Object.assign(Object.assign({},j),t.ui)}),this.messages=new O(this.options.messages||{},u),this.columnInfo=C(this.options.columns,this.options.sortable),this.create()}create(){this.wrapper=document.createElement("div"),this.wrapper.setAttribute("role","sf-datagrid-wrapper"),this.wrapper.setAttribute("class",this.options.ui.wrapperClassName||""),this.root.node.innerHTML="",this.root.node.appendChild(this.wrapper),this.options.actions&&this.createDefaultActions(),this.options.paginator&&this.createDefaultPaginator();const t=this.options.tableWrapper||F;this.tableEl=t(this.wrapper,this.options)}createDefaultPaginator(){const t=`${Date.now()}${this.instance}`;this.root.options.captureForms.push(t),this.paginatorEl=document.createElement("div"),this.root.node.appendChild(this.paginatorEl);const e=new E(a.a,this.paginatorEl,Object.assign(Object.assign({},E.defaultOptions),{id:t,messages:this.root.options.paginatorMessages}));this.root.registerPaginatorInstance(e)}createDefaultActions(){var t;const e=`${Date.now()}${this.instance}`;this.actionPanelEl=document.createElement("div"),this.root.node.appendChild(this.actionPanelEl),this.root.options.captureActionPanels||(this.root.options.captureActionPanels=[]),this.root.options.captureActionPanels.push(e);const s=new g(a.a,this.actionPanelEl,{id:e,className:t=>t.hasSelection?"row no-gutters align-items-center px-3 py-2 border-bottom":"d-none",lockType:"none",noSelection:document.createElement("div"),actionClassName:"btn btn-sm",selectionType:(null===(t=this.options.selectable)||void 0===t?void 0:t.type)||r.SINGLE,actions:this.options.actions});this.root.registerActionPanelInstance(s)}applyAdditionalCellAttributes(t,e,s,i,r){const n={id:e.id,column:e,index:r,rowSelected:!!s.selectable&&i.isSelected(i.data[r][s.selectable.id]),state:i,item:i.data[r]};if(s.ui.cellClassName)if("function"==typeof s.ui.cellClassName)t.classList.add(...s.ui.cellClassName(n).split(" "));else{const i=s.ui.cellClassName[e.id];i&&("string"==typeof i?t.classList.add(...i.split(" ")):t.classList.add(...i(n).split(" ")))}if(s.ui.cellAttributes)if("function"==typeof s.ui.cellAttributes)k(t,s.ui.cellAttributes(n));else{const i=s.ui.cellAttributes[e.id];i&&k(t,"function"==typeof i?i(n):i)}}applyAdditionalHeaderCellAttributes(t,e,s,i){const r={id:e.id,column:e,index:0,rowSelected:!!s.selectable&&i.areAllSelected(),state:i,item:null};if(s.ui.headerCellClassName)if("function"==typeof s.ui.headerCellClassName)t.classList.add(...s.ui.headerCellClassName(r).split(" "));else{const i=s.ui.headerCellClassName[e.id];i&&("string"==typeof i?t.classList.add(...i.split(" ")):t.classList.add(...i(r).split(" ")))}if(s.ui.headerCellAttributes)if("function"==typeof s.ui.headerCellAttributes)k(t,s.ui.headerCellAttributes(r));else{const i=s.ui.headerCellAttributes[e.id];i&&k(t,"function"==typeof i?i(r):i)}}render(t){const e=this.options.headerWrapper||P;this.headerEl&&this.tableEl.removeChild(this.headerEl.outer),this.headerEl=e(this.tableEl,this.options,t,this.messages),this.headerEl&&this.columnInfo.length&&this.columnInfo.forEach((e,s)=>{const i=(r=(this.options.headerList||{})[e.id])?function(t){return void 0!==t.createEl}(r)?r:{createEl:L,render:r}:M;var r;const n=i.createEl();if(n){const s=i.render(e,this.options,t);s&&("string"==typeof s?n.innerHTML=s:n.appendChild(s),this.applyAdditionalHeaderCellAttributes(n,e,this.options,t),this.headerEl.inner.appendChild(n))}}),this.bodyEl&&this.tableEl.removeChild(this.bodyEl);const s=this.options.bodyWrapper||x;if(this.bodyEl=s(this.tableEl,this.options,t,this.messages),this.bodyEl){this.tableEl.appendChild(this.bodyEl);const e=this.options.rowWrapper||A;t.data.forEach((s,i)=>{const r=e(this.bodyEl,this.options,t,i);this.columnInfo.forEach(e=>{const n=s[e.id],o=(a=(this.options.cells||{})[e.id])?function(t){return void 0!==t.createEl}(a)?a:{createEl:N,render:a}:D;var a;const c=o.createEl();if(c){const a=o.render(n,s,e,this.options,i,t);a&&("string"==typeof a?c.innerHTML=a:c.appendChild(a),this.applyAdditionalCellAttributes(c,e,this.options,t,i),r.appendChild(c))}})})}this.footerEl&&this.tableEl.removeChild(this.footerEl);const i=this.options.footerWrapper||T;this.footerEl=i(this.tableEl,this.options,t,this.messages),this.footerEl&&this.tableEl.appendChild(this.footerEl)}updateCheckboxes(t){var e,s;if(this.root.options.selectable){const i=null===(e=this.headerEl)||void 0===e?void 0:e.outer.querySelector("input[data-datagrid-select-all]");i&&(i.checked=t.areAllSelected());const r=null===(s=this.bodyEl)||void 0===s?void 0:s.querySelectorAll("input[data-datagrid-select]");r&&r.forEach(e=>{const s=e;s.checked=t.isSelected(s.value)})}}}var U=function(t,e,s,i){return new(s||(s=Promise))((function(r,n){function o(t){try{c(i.next(t))}catch(t){n(t)}}function a(t){try{c(i.throw(t))}catch(t){n(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof s?e:new s((function(t){t(e)}))).then(o,a)}c((i=i.apply(t,e||[])).next())}))},$=function(t,e){var s={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(s[i]=t[i]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(t);r<i.length;r++)e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(t,i[r])&&(s[i[r]]=t[i[r]])}return s};function z(t,e){const s={};return e.fetchCount&&(s.fetchCount=!0),Object.keys(e.filter).forEach(t=>{s[`filter[${t}]`]=e.filter[t]}),Object.keys(e.paginate).forEach(t=>{s[`paginate[${t}]`]=e.paginate[t]}),Object.keys(e.sort).forEach(t=>{s[`sort[${t}]`]=e.sort[t]}),Object(y.stringifyUrl)({url:t,query:s})}class B extends a.a.core.BaseDOMConstructor{constructor(t,e,s){super(),this.name=B.spiralFrameworkName,this.optionsToGrab={id:{value:B.defaultOptions.id,domAttr:"id"},url:{value:B.defaultOptions.url,domAttr:"data-url"}},this.options=Object.assign({},B.defaultOptions),this.grids=[],this.state=new b(this),this.capturedForms={},this.capturedPaginators=[],this.capturedActionPanels=[],this.defaults={page:1,limit:25},this.init(t,e,s),this.options=Object.assign(Object.assign(Object.assign({},B.defaultOptions),this.options),d(e)),m.notEqual(this.options.id,"","id should be not empty"),m.notEqual(this.options.url,"","url should be not empty"),this.columnInfo=C(this.options.columns,this.options.sortable),this.options.sort&&("string"==typeof this.options.sort?(this.defaults.sortBy=this.options.sort,this.defaults.sortDir=i.ASC):(this.defaults.sortBy=this.options.sort.field,this.defaults.sortDir=this.options.sort.direction||i.ASC),this.state.setSort(this.defaults.sortBy,this.defaults.sortDir)),this.createRenderers(),this.initFromUrl(),this.captureForms(),this.allFormsAttached()&&this.request()}registerFormInstance(t){if(t.options&&t.options.id&&this.options.captureForms.indexOf(t.options.url)>=0){const{id:e}=t.options,s=t.enumerateFieldNames();if(this.capturedForms[e]={instance:t,fields:s},t.options.jsonOnly=!0,t.getFormData){const s=t.getFormData();this.state.mergeDefaultData(s),this.state.setFormData(e,s)}t.options.beforeSubmitCallback=t=>(this.resetPaginator(),this.applyFormChange(e,t.data),this.request(),!1);const i=this.state.urlData?Object.keys(this.state.urlData).filter(t=>s.indexOf(t)>=0).reduce((t,e)=>Object.assign(Object.assign({},t),{[e]:this.state.urlData[e]}),{}):void 0;if(i){const r=Object.keys(i).filter(t=>s.indexOf(t)>=0).reduce((t,e)=>Object.assign(Object.assign({},t),{[e]:i[e]}),{});t.setFieldValues(r),this.state.setFormData(e,r)}this.options.captureForms=this.options.captureForms.filter(e=>e!==t.options.url),this.request()}}registerPaginatorInstance(t){t.options&&t.options.id&&this.options.captureForms.indexOf(t.options.id)>=0&&(this.capturedPaginators.push(t),t.options.willFetchCount=this.options.fetchCount,t.options.onPageChange=t=>(this.state.updatePaginator(t),this.request(),!1),this.options.captureForms=this.options.captureForms.filter(e=>e!==t.options.id),this.request())}registerActionPanelInstance(t){t.options&&t.options.id&&this.options.captureActionPanels&&this.options.captureActionPanels.indexOf(t.options.id)>=0&&(this.capturedActionPanels.push(t),this.options.selectable&&(t.reconfigure({selectionType:this.options.selectable.type}),t.setSelection(this.state.selection,this.state.selectedItems)))}captureForms(){(this.sf.getInstances("form")||[]).forEach(t=>{this.registerFormInstance(t.instance)}),(this.sf.getInstances(E.spiralFrameworkName)||[]).forEach(t=>{this.registerPaginatorInstance(t.instance)}),(this.sf.getInstances(g.spiralFrameworkName)||[]).forEach(t=>{this.registerActionPanelInstance(t.instance)}),this.sf.instancesController.events.on("onAddInstance",({instance:t,type:e})=>{"form"===e&&this.registerFormInstance(t),e===E.spiralFrameworkName&&this.registerPaginatorInstance(t),e===g.spiralFrameworkName&&this.registerActionPanelInstance(t)})}triggerSort(t){if(this.state.sortBy===t)this.state.sortDir===i.ASC?this.state.setSort(t,i.DESC):this.state.setSort(t,i.ASC);else{const e=this.columnInfo.find(e=>e.id===t);e?this.state.setSort(e.id,e.direction):console.warn(`Trying to sort by unsortable field ${t}`)}this.resetPaginator(),this.request()}setAllPaginators(t){this.capturedPaginators.forEach(e=>{e.setParams&&e.setParams(t,this.usePrefix()?this.getPrefix():this.options.serialize)})}resetPaginator(){this.state.resetFetchCount(),this.state.updatePaginator({page:1}),this.setAllPaginators(this.state.paginate)}formRequest(){return{fetchCount:this.state.needFetchCount,filter:this.state.getFilter(),paginate:this.state.paginate,sort:this.state.sortBy?{[this.state.sortBy]:this.state.sortDir}:{}}}unlock(){this.sf.removeInstance("lock",this.node)||console.warn("You try to remove 'lock' instance, but it is not available or not started"),Object.keys(this.capturedForms).forEach(t=>{const e=this.capturedForms[t].instance;e.unlock&&e.unlock()}),this.capturedPaginators.forEach(t=>{t.unlock&&t.unlock()})}lock(){if(!this.options.lockType||"none"===this.options.lockType)return;this.sf.addInstance("lock",this.node,{type:this.options.lockType})?(Object.keys(this.capturedForms).forEach(t=>{const e=this.capturedForms[t].instance;e.lock&&e.lock()}),this.capturedPaginators.forEach(t=>{t.lock&&t.lock()})):console.warn("You try to add 'lock' instance, but it is not available or already started")}handleSuccess({data:t}){this.state.setSuccess(t.data,t.pagination),void 0!==t.pagination.count&&this.state.onCountFetched(),this.render(),this.setAllPaginators(Object.assign(Object.assign({},this.state.paginate),{error:!1}))}beforeSubmit(){Object.keys(this.capturedForms).forEach(t=>{const e=this.capturedForms[t].instance;e.removeMessages&&e.removeMessages()})}handleError(t){const{data:e,status:s,statusText:i}=this.processResponse(t);this.state.setError(e.error,e.errors,this.options.resetOnError),Object.keys(this.capturedForms).forEach(t=>{const r=this.capturedForms[t].instance;if(r.processAnswer){const t=r.options.url,{error:n}=e,o=$(e,["error"]),a=t===this.options.errorMessageTarget?Object.assign({},e):o;r.processAnswer({data:a,status:s,statusText:i},!1)}}),this.setAllPaginators({error:!0}),this.render()}request(){return U(this,void 0,void 0,(function*(){if(!this.allFormsAttached())return void console.warn("Cant start new request, not all forms are yet attached",this.options.captureForms);if(this.state.isLoading)return void console.warn("Cant start new request, old one is running");this.state.startLoading(),this.beforeSubmit(),this.lock(),this.updateUrl();const t=this.options.method.toUpperCase()===n.GET,e=this.formRequest(),s=this.sf.ajax.send({url:t?z(this.options.url,e):this.options.url,method:this.options.method,headers:this.options.headers,data:t?void 0:e});try{const t=this.processResponse(yield s);this.handleSuccess(t)}catch(t){t.isSFAjaxError?this.handleError(t):this.handleError({data:{error:t.toString(),originalError:t},status:1e3,statusText:t.toString()})}finally{this.unlock(),this.state.stopLoading()}}))}createRenderers(){m.deepEqual(this.grids,[],"Grids are already initialized"),(Array.isArray(this.options.renderers)?this.options.renderers:[this.options.renderers]).forEach(t=>{this.grids.push(new q(Object.assign(Object.assign({},t),{ui:Object.assign(Object.assign({},this.options.ui),t.ui),columns:t.columns&&t.columns.length?t.columns:this.options.columns,sortable:t.sortable&&t.sortable.length?t.sortable:this.options.sortable,paginator:void 0===t.paginator?this.options.paginator:t.paginator,dontRenderError:!!this.options.errorMessageTarget,selectable:t.selectable||this.options.selectable,messages:Object.assign(Object.assign({},this.options.messages),t.messages),paginatorMessages:Object.assign(Object.assign({},this.options.paginatorMessages),t.paginatorMessages)}),this))})}render(){this.grids.forEach(t=>{t.render(this.state)})}updateCheckboxes(){this.grids.forEach(t=>{t.updateCheckboxes(this.state)}),this.capturedActionPanels.forEach(t=>{t.setSelection(this.state.selection,this.state.selectedItems)})}toggleSelectionAll(t){this.options.selectable&&(t?this.state.selectAll():this.state.resetSelection()),this.updateCheckboxes()}toggleSelection(t,e){this.options.selectable&&(this.options.selectable.type===r.MULTIPLE?e?this.state.addToSelection(t):this.state.removeFromSelection(t):e&&this.state.selectSingle(t)),this.updateCheckboxes()}serialize(){const t=this.state.getFilter(),e=Object.keys(this.state.paginate).filter(t=>c.indexOf(t)>=0).reduce((t,e)=>Object.assign(Object.assign({},t),{[e]:this.state.paginate[e]}),{}),s=this.state.sortBy?{sortBy:this.state.sortBy,sortDir:this.state.sortDir}:{};return Object.assign(Object.assign(Object.assign({},t),e),s)}deserialize(t){const{page:e,limit:s,cid:r,lid:n}=t,o=$(t,["page","limit","cid","lid"]),a={page:this.defaults.page,limit:this.defaults.limit};e&&(a.page=+e),s&&(a.limit=+s),r&&(a.cid=r),n&&(a.lid=n),this.state.updatePaginator(a);const{sortBy:u,sortDir:p}=o,h=$(o,["sortBy","sortDir"]);u&&this.state.setSort(u,p||i.ASC),[...c,...l].forEach(t=>delete h[t]),this.state.urlData=h}usePrefix(){return this.options.serialize&&this.options.namespace}getPrefix(){return this.usePrefix()?`${this.options.namespace||""}-`:""}initFromUrl(){if(this.options.serialize&&window.location.search){const t=this.getObjectFromUrl(this.getDefaults(),this.getPrefix());Object.keys(t).length&&this.deserialize(t)}}updateUrl(){if(this.options.serialize){const t=this.serialize();this.putObjectToUrl(t,this.getDefaults(),this.getPrefix())}}getObjectFromUrl(t,e=""){const s=Object(y.parse)(window.location.search,{parseNumbers:!0,parseBooleans:!0});return Object.keys(s).reduce((i,r)=>e&&0!==r.indexOf(e)?i:Object.assign(Object.assign({},i),{[r.substr(e.length)]:void 0!==s[r]?s[r]:t[r.substr(e.length)]}),{})}putObjectToUrl(t,e,s=""){if(!window.history)return void console.warn("Cant update URL without reload, skipping");const i=Object.keys(t).reduce((i,r)=>t[r]&&t[r]!=e[r]?Object.assign(Object.assign({},i),{[`${s}${r}`]:t[r]}):i,{});let r=Object(y.parse)(window.location.search,{parseNumbers:!0,parseBooleans:!0});this.usePrefix()?Object.keys(r).forEach(t=>{0===t.indexOf(this.getPrefix())&&delete r[t]}):r={};const n=Object.assign(Object.assign({},r),i);window.history.pushState({},document.title,Object(y.stringifyUrl)({url:`${window.location.protocol}//${window.location.host}${window.location.pathname}`,query:n}))}getDefaults(){return Object.assign(Object.assign({},this.defaults),this.state.defaultData)}allFormsAttached(){return 0===this.options.captureForms.length}applyFormChange(t,e){this.capturedForms[t].fields=[...new Set([...Object.keys(e),...this.capturedForms[t].fields])],this.state.setFormData(t,e),Object.keys(this.capturedForms).filter(e=>e!==t).forEach(t=>{const s=this.capturedForms[t],{fields:i}=s,r=Object.keys(e).filter(t=>i.indexOf(t)>=0).reduce((t,s)=>Object.assign(Object.assign({},t),{[s]:e[s]}),{});s.instance.setFieldValues(r)})}processResponse(t){if(this.options.responseProcessor)return this.options.responseProcessor(t);if(this.options.dataField){const e=this.options.dataField;if(t.data&&t.data[e])return Object.assign(Object.assign({},t),{data:Object.assign(Object.assign({},t.data),{data:t.data[e]})})}return t}}B.spiralFrameworkName="datagrid",B.defaultOptions=S;var _=B;a.a.registerInstanceType(_,"sf-js-datagrid"),a.a.registerInstanceType(E,"sf-js-datagrid-paginator"),a.a.registerInstanceType(g,"sf-js-datagrid-actionpanel");e.default=_}])}));
//# sourceMappingURL=datagrid.js.map